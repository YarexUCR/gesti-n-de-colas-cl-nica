<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Simulaci√≥n M/M/c</title>
    <style>
      * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

      body {
        font-family: Arial, sans-serif;
 
        background: #f9f9f9;
      }
      .section {
        margin: 50px 20px;
        margin-bottom: 2rem;
        padding: 1rem;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        width: 100%;
      }
      h2 {
        margin-top: 0;
      }
      label {
        display: block;
        margin-top: 1rem;
      }
      input {
        width: 100%;
        padding: 5px;
        margin-top: 5px;
      }
      button {
        margin-top: 1rem;
        padding: 0.5rem 1rem;
      }
      body { font-family: Arial; margin: 0; }
    header { background:#2c3e50; color:white; padding:15px;  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    nav { display:flex; justify-content:space-between; align-items:center; }
    nav a { color:white; margin-right:20px; text-decoration: none; font-weight: bold; }
    .content { padding: 20px; }

    .container-sections {
      display: flex;
      justify-content: center;
     
    }

    </style>
  </head>
  <header>
    <nav>
      <h2 style="margin:0;"><a href="menu.html">Panel del Gerente</a></h2>
      <div style="display: flex; gap: 10px;">
         <a href="gerente-usuarios.html">Usuarios</a>
        <a href="gerente-consultorios.html">Consultorios</a>
        <a href="calculos-datos-reales.html">Resultados datos reales</a>
        <a href="calculos-simulacion.html">Resultados datos simulacion</a>
    </nav>
  </header>

  <h3 style="padding: 20px;">üìä Resultados con datos reales</h3>

  <body>

    
    <div class="container-sections">

       <div class="section">
      <h2>üìä Datos Reales Calculados</h2> <br><br>
      <div style="display: flex; justify-content: space-between; gap: 2rem">
        <!-- Columna izquierda: Entradas -->
        <div style="flex: 1">
          <h3>üî¢ Entradas</h3>
          <div id="datosRealesEntradas"></div>
        </div>

        <!-- Columna derecha: Resultados -->
        <div style="flex: 1">
          <h3>üìà Resultados</h3>
          <div id="datosRealesResultados"></div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>üîß C√°lculo del N√∫mero √ìptimo de Servidores</h2>
      <form id="formOptimo">
   
        <label
          >Costo de espera por cliente (‚Ç°):
          <input type="number" step="0.01" name="costo_espera" required
        /></label>
        <label
          >Costo por servidor (‚Ç°):
          <input type="number" step="0.01" name="costo_servidor" required
        /></label>
        <button type="submit">Calcular Servidor √ìptimo</button>
      </form>
      <div id="resultadoOptimo"></div>
      <div id="resultadosotros"></div>
    </div>


    </div>

   

    <script>
      let datosReales = {
        tasaLlegada_lambda: 0,
        tasaServicio_mu: 0,
        servidores_c: 0,
      };
      async function cargarDatosReales() {
        try {
          const res = await fetch("/api/metricas/entradas-mmc");
          const data = await res.json();

          const lambda = parseFloat(data.tasaLlegada_lambda);
          const mu = parseFloat(data.tasaServicio_mu);
          const c = parseInt(data.servidores_c);

          datosReales.lambda = lambda;
          datosReales.mu = mu;
          datosReales.c = c;

          document.getElementById("datosRealesEntradas").innerHTML = `<br>
      <p><strong>Œª (Tasa de llegada):</strong> ${lambda.toFixed(4)}</p> <br>
      <p><strong>Œº (Tasa de servicio):</strong> ${mu.toFixed(4)}</p> <br>
      <p><strong>c (Servidores):</strong> ${c}</p>
    `;

          // Llamar a la API Flask con estos valores reales
          const mmcResponse = await fetch("http://127.0.0.1:5000/api/colas", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              tasa_llegada: lambda,
              tiempo_servicio: mu,
              servidores: c,
            }),
          });

          const mmcData = await mmcResponse.json();

          if (mmcData.error) {
            document.getElementById(
              "datosRealesResultados"
            ).innerHTML = `<p style="color:red;">${mmcData.error}</p>`;
          } else {

            datosReales.mu = mmcData.mu;


            document.getElementById("datosRealesResultados").innerHTML = `
        <p><strong>œÅ (Utilizaci√≥n):</strong> ${mmcData.rho}</p>
        <p><strong>p‚ÇÄ (Sistema vac√≠o):</strong> ${mmcData.p0}</p>
        <p><strong>L (Clientes en sistema):</strong> ${mmcData.L}</p>
        <p><strong>Lq (Clientes en cola):</strong> ${mmcData.Lq}</p>
        <p><strong>W (Tiempo total - min):</strong> ${mmcData.W}</p>
        <p><strong>Wq (Espera en cola - min):</strong> ${mmcData.Wq}</p>
        <p><strong>mu (Tiempo de servicio promedio):</strong> ${mmcData.mu}</p>
        <p><strong>Recomendaci√≥n:</strong> ${mmcData.recomendacion}</p>
      `;
          }
        } catch (error) {
          console.error("Error al cargar m√©tricas reales:", error);
          document.getElementById("datosRealesEntradas").innerHTML =
            "<p><br>Error al cargar datos reales.</p>";
          document.getElementById("datosRealesResultados").innerHTML = "";
        }
      }

      async function calcularOptimo(event) {
        event.preventDefault();
        const form = event.target;
        const valores = {
          tasa_llegada: datosReales.lambda,
          tiempo_servicio: datosReales.mu,
          costo_espera: parseFloat(form.costo_espera.value),
          costo_servidor: parseFloat(form.costo_servidor.value),
        };

        try {
          const res = await fetch("http://127.0.0.1:5000/api/colas/optimo", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(valores),
          });

          const data = await res.json();
          if (data.error) {
            document.getElementById(
              "resultadoOptimo"
            ).innerHTML = `<p style="color:red;">${data.error}</p>`;
            return;
          }

          const opt = data.optimo;
          document.getElementById("resultadoOptimo").innerHTML = `
          <p><strong>Servidores √≥ptimos:</strong> ${opt.servidores}</p>
          <p><strong>Lq:</strong> ${opt.Lq}</p>
          <p><strong>Wq (min):</strong> ${opt.Wq}</p>
          <p><strong>œÅ:</strong> ${opt.rho}</p>
          <p><strong>Costo total:</strong> ‚Ç°${opt.costo_total}</p>
        `;

          const opciones = data.todas_las_opciones;

          let tablaHTML = `
  <table border="1">
    <thead>
      <tr>
        <th>Servidores</th>
        <th>Lq</th>
        <th>Wq (min)</th>
        <th>œÅ</th>
        <th>Costo total (‚Ç°)</th>
      </tr>
    </thead>
    <tbody>
`;

          opciones.forEach((op) => {
            tablaHTML += `
    <tr>
      <td>${op.servidores}</td>
      <td>${op.Lq}</td>
      <td>${op.Wq}</td>
      <td>${op.rho}</td>
      <td>‚Ç°${op.costo_total}</td>
    </tr>
  `;
          });

          tablaHTML += `</tbody></table>`;
          document.getElementById("resultadosotros").innerHTML = tablaHTML;

        } catch (error) {
          document.getElementById("resultadoOptimo").innerHTML =
            "Error al calcular √≥ptimo.";
            document.getElementById("resultadoOptimo").innerHTML = "Error al calcular √≥ptimo.";;

        }
      }

      document
        .getElementById("formOptimo")
        .addEventListener("submit", calcularOptimo);
      cargarDatosReales();

    
  function toggleSubmenu(event) {
    event.preventDefault(); // evita que el href="#" recargue la p√°gina
    const submenu = document.getElementById('submenu');
    submenu.style.display = submenu.style.display === 'none' ? 'block' : 'none';
  }



    </script>
  </body>
</html>
