<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Simulaci√≥n M/M/c</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 2rem;
        background: #f9f9f9;
      }
      .section {
        margin-bottom: 2rem;
        padding: 1rem;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      h2 {
        margin-top: 0;
      }
      label {
        display: block;
        margin-top: 1rem;
      }
      input {
        width: 100%;
        padding: 5px;
        margin-top: 5px;
      }
      button {
        margin-top: 1rem;
        padding: 0.5rem 1rem;
      }
      body {
        font-family: Arial;
        margin: 0;
      }
      header {
        background: #2c3e50;
        color: white;
        padding: 15px;
      }
      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      nav a {
        color: white;
        margin-right: 20px;
        text-decoration: none;
        font-weight: bold;
      }
      .content {
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <h2 style="margin: 0"><a href="menu.html">Panel del Gerente</a></h2>
        <div style="display: flex; gap: 10px">
          <a href="gerente-usuarios.html">Usuarios</a>
          <a href="gerente-consultorios.html">Consultorios</a>
          <div style="position: relative">
            <a href="#" onclick="toggleSubmenu(event)">Resultados ‚ñæ</a>
            <div id="submenu" style="display: none; margin-left: 15px">
              <a href="calculos-datos-reales.html"> Resultados Reales</a><br />
              <a href="calculos-simulacion.html">calculadora</a>
            </div>
          </div>
        </div>
      </nav>
    </header>
    <div class="section">
      <h2>üß™ Simular Escenario Personalizado</h2>
      <form id="formSimulacion">
        <label
          >Tasa de llegada (Œª):
          <input type="number" step="0.01" name="tasa_llegada" required
        /></label>
        <label
          >Tiempo de servicio promedio (min):
          <input type="number" step="0.01" name="tiempo_servicio" required
        /></label>
        <label
          >Servidores (c): <input type="number" name="servidores" required
        /></label>
        <button type="submit">Calcular M√©tricas</button>
      </form>
      <div id="resultadoSimulado"></div>
    </div>

    <div class="section">
      <h2>üîß C√°lculo del N√∫mero √ìptimo de Servidores</h2>
      <form id="formOptimo">
        <label
          >Costo de espera por cliente (‚Ç°):
          <input type="number" step="0.01" name="costo_espera" required
        /></label>
        <label
          >Costo por servidor (‚Ç°):
          <input type="number" step="0.01" name="costo_servidor" required
        /></label>
        <button type="submit">Calcular Servidor √ìptimo</button>
      </form>
      <div id="resultadoOptimo"></div>
      <div id="otrosResuultados"></div>
    </div>

    <script>
      let datosrepetidos = {
        tasaLlegada_lambda: 0,
        tasaServicio_mu: 0,
        servidores_c: 0,
      };

      async function simular(event) {
        event.preventDefault();
        const form = event.target;

        const valores = {
          tasa_llegada: parseFloat(form.tasa_llegada.value),
        tiempo_servicio: parseFloat(form.tiempo_servicio.value),
          servidores: parseInt(form.servidores.value),
        };

        datosrepetidos.lambda = valores.tasa_llegada;
        try {
          const res = await fetch("http://127.0.0.1:5000/api/colas", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(valores),
          });
          const data = await res.json();

          if (data.error) {
            document.getElementById(
              "resultadoSimulado"
            ).innerHTML = `<p style="color:red;">${data.error}</p>`;
            return;
          }
          datosrepetidos.tasaServicio_mu = data.mu;
          datosrepetidos.tasaLlegada_lambda = data.lambda;
          document.getElementById("resultadoSimulado").innerHTML = `
          <p><strong>œÅ (Utilizaci√≥n):</strong> ${data.rho}</p>
          <p><strong>P0:</strong> ${data.p0}</p>
          <p><strong>Lq:</strong> ${data.Lq}</p>
          <p><strong>Wq (min):</strong> ${data.Wq}</p>
          <p><strong>W (min):</strong> ${data.W}</p>
          <p><strong>L:</strong> ${data.L}</p>
          <p><strong>mu (Tiempo de servicio promedio):</strong> ${data.mu}</p>
          <p><strong>Recomendaci√≥n:</strong> ${data.recomendacion}</p>
        `;
        } catch (error) {
          document.getElementById("resultadoSimulado").innerHTML =
            "Error al simular.";
        }
      }

      async function calcularOptimo(event) {
        event.preventDefault();
        const form = event.target;
        const valores = {
          tasa_llegada: datosrepetidos.tasaLlegada_lambda,
          tiempo_servicio: datosrepetidos.tasaServicio_mu,
          costo_espera: parseFloat(form.costo_espera.value),
          costo_servidor: parseFloat(form.costo_servidor.value),
        };

        try {
          const res = await fetch("http://127.0.0.1:5000/api/colas/optimo", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(valores),
          });

          const data = await res.json();
          if (data.error) {
            document.getElementById(
              "resultadoOptimo"
            ).innerHTML = `<p style="color:red;">${data.error}</p>`;
            return;
          }

          const opt = data.optimo;
          document.getElementById("resultadoOptimo").innerHTML = `
          <p><strong>Servidores √≥ptimos:</strong> ${opt.servidores}</p>
          <p><strong>Lq:</strong> ${opt.Lq}</p>
          <p><strong>Wq (min):</strong> ${opt.Wq}</p>
          <p><strong>œÅ:</strong> ${opt.rho}</p>
          <p><strong>Costo total:</strong> ‚Ç°${opt.costo_total}</p>
          
        `;
          const opciones = data.todas_las_opciones;

          let tablaHTML = `
<table border="1">
<thead>
<tr>
<th>Servidores</th>
<th>Lq</th>
<th>Wq (min)</th>
<th>œÅ</th>
<th>Costo total (‚Ç°)</th>
</tr>
</thead>
<tbody>
`;

          opciones.forEach((op) => {
            tablaHTML += `
<tr>
<td>${op.servidores}</td>
<td>${op.Lq}</td>
<td>${op.Wq}</td>
<td>${op.rho}</td>
<td>‚Ç°${op.costo_total}</td>
</tr>
`;
          });

          tablaHTML += `</tbody></table>`;
          document.getElementById("otrosResuultados").innerHTML = tablaHTML;
        } catch (error) {
          document.getElementById("otrosResuultados").innerHTML =
          "Error al simular.";
          document.getElementById("resultadoOptimo").innerHTML =
            "Error al calcular √≥ptimo.";
        }
      }

      document
        .getElementById("formSimulacion")
        .addEventListener("submit", simular);
      document
        .getElementById("formOptimo")
        .addEventListener("submit", calcularOptimo);

      function toggleSubmenu(event) {
        event.preventDefault(); // evita que el href="#" recargue la p√°gina
        const submenu = document.getElementById("submenu");
        submenu.style.display =
          submenu.style.display === "none" ? "block" : "none";
      }
    </script>
  </body>
</html>
